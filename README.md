# Telegram è‚¡ç¥¨è³‡è¨Šæ©Ÿå™¨äºº

## åŠŸèƒ½ç°¡ä»‹

é€™æ˜¯ä¸€å€‹åŸºæ–¼ Python å’Œ `python-telegram-bot` é–‹ç™¼çš„ **Telegram è‚¡ç¥¨è³‡è¨Šæ©Ÿå™¨äºº**ï¼Œæä¾›å³æ™‚è‚¡ç¥¨æ•¸æ“šæŸ¥è©¢ã€K ç·šåœ–ç”Ÿæˆï¼Œè‚¡åƒ¹é æ¸¬åŠŸèƒ½ï¼Œä»¥åŠå¼·å¤§çš„åŸºæœ¬é¢åˆ†æå’Œ AI æ™ºèƒ½å›æ‡‰ã€‚  
ç›®å‰æ”¯æ´ **å°è‚¡** å’Œ **ç¾è‚¡** è‚¡ç¥¨ã€‚

![alt text](image.png)

![alt text](image-1.png)

![alt text](image-2.png)

### åŠŸèƒ½åˆ—è¡¨ï¼š

1. **è‚¡åƒ¹æŸ¥è©¢èˆ‡ K ç·šåœ–**
   - `/s è‚¡ç¥¨ä»£ç¢¼`ï¼šæŸ¥è©¢æœ€æ–°è‚¡åƒ¹ã€é–‹ç›¤åƒ¹ã€æ”¶ç›¤åƒ¹ã€æœ€é«˜åƒ¹ã€æœ€ä½åƒ¹ã€æˆäº¤é‡ï¼Œä¸¦æä¾›æ—¥Kã€é€±K å’ŒæœˆK ç·šåœ–ã€‚

2. **ç¾è‚¡æ–°èæŸ¥è©¢**
   - `/n è‚¡ç¥¨ä»£ç¢¼`ï¼šæŸ¥è©¢ç¾è‚¡è‚¡ç¥¨çš„æœ€æ–°ç›¸é—œæ–°èã€‚

3. **å°è‚¡æ–°èæŸ¥è©¢**
   - `/ny è‚¡ç¥¨ä»£ç¢¼`ï¼šæŸ¥è©¢ Yahoo å°è‚¡æ–°èã€‚

4. **è‚¡åƒ¹é æ¸¬åŠŸèƒ½**
   - `/p è‚¡ç¥¨ä»£ç¢¼`ï¼šä½¿ç”¨ Prophet æ¨¡å‹é æ¸¬æœªä¾† 5 å¤©çš„è‚¡åƒ¹ç¯„åœã€‚

5. **AI åŸºæœ¬é¢åˆ†æ**
   - `/ai è‚¡ç¥¨ä»£ç¢¼`ï¼šä½¿ç”¨ LangGraph å’Œå¤šå€‹å·¥å…·é€²è¡Œæ·±åº¦åŸºæœ¬é¢åˆ†æï¼ŒåŒ…å«ï¼š
     - æŠ€è¡“æŒ‡æ¨™åˆ†æï¼ˆRSIã€MACDã€VWAPã€éš¨æ©ŸæŒ‡æ¨™ï¼‰
     - è²¡å‹™å¥åº·åº¦è©•ä¼°ï¼ˆP/Eã€P/Bã€è² å‚µæ¬Šç›Šæ¯”ã€åˆ©æ½¤ç‡ç­‰ï¼‰
     - æœ€æ–°æ–°èèˆ‡å¸‚å ´æƒ…ç·’åˆ†æ
     - ç¶œåˆæŠ•è³‡å»ºè­°ï¼ˆè²·å…¥/æŒæœ‰/è³£å‡ºï¼‰

6. **æŠ•è³‡å¤§å¸«é›†é«”åˆ†æ**
   - `/ai2 è‚¡ç¥¨ä»£ç¢¼`ï¼šé€£æ¥å°ˆæ¥­æŠ•è³‡åˆ†æ APIï¼Œæä¾›å¤šä½çŸ¥åæŠ•è³‡å¤§å¸«çš„é›†é«”åˆ†æï¼š
     
     **åƒ¹å€¼æŠ•è³‡å¤§å¸« (7ä½)ï¼š**
     - ğŸ‘´ è¯å€«Â·å·´è²ç‰¹ (Warren Buffett) - é•·æœŸåƒ¹å€¼æŠ•è³‡ï¼Œå°‹æ‰¾å„ªè³ªä¼æ¥­
     - ğŸ§“ æŸ¥ç†Â·è’™æ ¼ (Charlie Munger) - å“è³ªæŠ•è³‡ï¼Œå°‹æ‰¾è­·åŸæ²³èˆ‡é«˜ ROE
     - ğŸ“š ç­å‚‘æ˜Â·è‘›æ‹‰æ¼¢ (Ben Graham) - åƒ¹å€¼æŠ•è³‡ä¹‹çˆ¶ï¼Œé‡è¦–å®‰å…¨é‚Šéš›
     - ğŸ‘¨â€ğŸ’¼ æ¯”çˆ¾Â·é˜¿å…‹æ›¼ (Bill Ackman) - æ¿€é€²åƒ¹å€¼æŠ•è³‡ï¼Œå°ˆæ³¨å„ªè³ªä¼æ¥­
     - ğŸ˜ éº¥å¯Â·è²ç‘ (Michael Burry) - æ·±åº¦åƒ¹å€¼æŠ•è³‡ï¼Œå°‹æ‰¾è¢«ä½ä¼°è³‡ç”¢
     - ğŸ¤  å½¼å¾—Â·æ—å€ (Peter Lynch) - æˆé•·åƒ¹å€¼æŠ•è³‡ï¼Œé‡è¦– PEG Ratio
     - ğŸ“– è²çˆ¾Â·è²»é›ª (Phil Fisher) - æˆé•·æ½›åŠ›åˆ†æï¼Œé‡è¦–ç ”ç™¼èˆ‡ç®¡ç†å“è³ª
     
     **æˆé•·èˆ‡å‰µæ–° (1ä½)ï¼š**
     - ğŸ‘©â€ğŸ’¼ å‡±è¥¿Â·ä¼å¾· (Cathie Wood) - é¡›è¦†å¼å‰µæ–°æŠ•è³‡ï¼Œèšç„¦ AIã€é›»å‹•è»Šã€åŸºå› ç§‘æŠ€
     
     **æŠ€è¡“èˆ‡æƒ…ç·’åˆ†æ (4ä½)ï¼š**
     - ğŸ‘µ å—å¸ŒÂ·ä½©æ´›è¥¿ (Nancy Pelosi) - è¿½è¹¤åœ‹æœƒè­°å“¡è‚¡ç¥¨äº¤æ˜“è¨˜éŒ„
     - ğŸ¦ è¯çˆ¾è¡—è³­å ´ (WallStreetBets) - Reddit ç¤¾ç¾¤æƒ…ç·’ã€æ•£æˆ¶å‹•èƒ½åˆ†æ
     - ğŸ“‰ æŠ€è¡“åˆ†æå¸« (Technical Analyst) - MAã€RSIã€MACD ç­‰æŠ€è¡“æŒ‡æ¨™
     - ğŸ” æƒ…ç·’åˆ†æå¸« (Sentiment Analyst) - æ–°èæƒ…ç·’åˆ†æã€å¸‚å ´æ°›åœè©•ä¼°
     
     **åŸºæœ¬é¢èˆ‡ä¼°å€¼åˆ†æ (2ä½)ï¼š**
     - ğŸ“ˆ åŸºæœ¬é¢åˆ†æå¸« (Fundamentals Analyst) - æ·±åº¦è²¡å‹™å ±è¡¨åˆ†æ
     - ğŸ’° ä¼°å€¼åˆ†æå¸« (Valuation Analyst) - ä¼æ¥­ä¼°å€¼æ¨¡å‹ã€DCF åˆ†æ
     
     - æœ€çµ‚çµ¦å‡ºç¶œåˆæ±ºç­–å»ºè­°ï¼ˆè²·å…¥/è³£å‡º/æŒæœ‰/åšç©ºï¼‰åŠä¿¡å¿ƒåº¦è©•åˆ†

7. **LLM æ™ºèƒ½å›ç­”**
   - `/llm å•é¡Œ`ï¼šé€£æ¥ DIFY LLM APIï¼Œä½¿ç”¨å…ˆé€²çš„èªè¨€æ¨¡å‹å›ç­”è‚¡ç¥¨ç›¸é—œå•é¡Œï¼š
     - æ”¯æ´ä¸²æµå¼å›æ‡‰ï¼Œå³æ™‚é¡¯ç¤º AI åˆ†æçµæœ
     - å¯è©¢å•ä»»ä½•è‚¡ç¥¨ç›¸é—œå•é¡Œï¼Œå¦‚ï¼š`/llm AVGO çš„è‚¡åƒ¹å‰æ™¯å¦‚ä½•ï¼Ÿ`
     - é©åˆé…åˆ `/ai` æˆ– `/ai2` æŒ‡ä»¤ä½¿ç”¨ï¼Œé€²è¡Œæ·±åº¦å•ç­”

8. **å…¶ä»–å·¥å…·é€£çµ**
   - `/h`ï¼šé¡¯ç¤ºå…¶ä»–è‚¡ç¥¨é æ¸¬å·¥å…·çš„é€£çµã€‚

## æŠ€è¡“æ¶æ§‹

æœ¬æ©Ÿå™¨äººæ¡ç”¨å…ˆé€²çš„æŠ€è¡“æ¶æ§‹ï¼š

- **è³‡æ–™ç²å–**ï¼šä½¿ç”¨ `yfinance` ç²å–å³æ™‚è‚¡ç¥¨æ•¸æ“š
- **æ•¸æ“šè¦–è¦ºåŒ–**ï¼šä½¿ç”¨ `matplotlib` ç”Ÿæˆå°ˆæ¥­é‡‘èåœ–è¡¨
- **ç¶²é çˆ¬èŸ²**ï¼šä½¿ç”¨ `BeautifulSoup` çˆ¬å–æœ€æ–°è²¡ç¶“æ–°è
- **AI æ¨¡å‹æ•´åˆ**ï¼š
  - ä½¿ç”¨ `LangGraph` å’Œ `LangChain` æ§‹å»ºå·¥å…·éˆé€²è¡ŒåŸºæœ¬é¢åˆ†æ
  - æ•´åˆ `Prophet` æ¨¡å‹é€²è¡Œè‚¡åƒ¹é æ¸¬
- **è‡ªç„¶èªè¨€è™•ç†**ï¼šé€£æ¥å¤–éƒ¨ LLM API æä¾›æ™ºèƒ½å›ç­”

### åŸºæœ¬é¢åˆ†æå·¥å…·

`/ai` å‘½ä»¤ä½¿ç”¨äº†ä¸‰ç¨®æ ¸å¿ƒå·¥å…·é€²è¡Œå…¨é¢åˆ†æï¼š

- **get_stock_prices**ï¼šç²å–è‚¡åƒ¹å’ŒæŠ€è¡“æŒ‡æ¨™ï¼ˆRSIã€MACDã€VWAPã€KD éš¨æ©ŸæŒ‡æ¨™ï¼‰
- **get_financial_metrics**ï¼šç²å–é—œéµè²¡å‹™æŒ‡æ¨™ï¼ˆP/Eã€P/Bã€è² å‚µæ¬Šç›Šæ¯”ã€åˆ©æ½¤ç‡ç­‰ï¼‰
- **get_financial_news**ï¼šç²å–æœ€æ–°æ–°èä¸¦åˆ†æå…¶å°å¸‚å ´æƒ…ç·’çš„å½±éŸ¿

---

## éƒ¨ç½²æ–¹å¼

### ä½¿ç”¨ Docker åŸ·è¡Œ

è‹¥è¦å¿«é€Ÿå•Ÿå‹•æ©Ÿå™¨äººï¼Œå¯ç›´æ¥å¾ Docker Hub ä¸‹è¼‰æ˜ åƒä¸¦åŸ·è¡Œï¼š

```bash
docker pull tbdavid2019/telegram-bot-stock2:latest
```

å•Ÿå‹•å®¹å™¨æ™‚éœ€æŒ‡å®š Telegram Bot Token å’Œ OpenAI API Keyï¼ˆç”¨æ–¼ AI åŠŸèƒ½ï¼‰ï¼š

```bash
docker run -d --name telegram-bot-stock2 \
  -e TELEGRAM_BOT_TOKEN=<ä½ çš„ Telegram Bot Token> \
  -e OPENAI_API_KEY=<ä½ çš„ OpenAI API Key> \
  -e OPENAI_MODEL=gpt-4o \
  -e OPENAI_BASE_URL=<é¸å¡«: è‡ªè¨‚ API ç«¯é»> \
  -e DIFY_API_KEY=<ä½ çš„ DIFY API Key> \
  -e DIFY_BASE_URL=<é¸å¡«: é è¨­ç‚º http://llm.glsoft.ai/v1/chat-messages> \
  tbdavid2019/telegram-bot-stock2:latest
```

### æ‰‹å‹•éƒ¨ç½²

#### ç’°å¢ƒéœ€æ±‚

- Python 3.9+
- ç›¸é—œå¥—ä»¶ï¼ˆå·²åˆ—æ–¼ requirements.txtï¼‰

#### æ­¥é©Ÿ

1. å®‰è£å¿…è¦å¥—ä»¶ï¼š
```bash
pip install -r requirements.txt
```

2. è¨­ç½®ç’°å¢ƒè®Šæ•¸ï¼š
å‰µå»º .env æª”æ¡ˆï¼Œä¸¦è¼¸å…¥å¿…è¦çš„ API Keysï¼š
```
TELEGRAM_BOT_TOKEN=ä½ çš„ Telegram Bot Token
OPENAI_API_KEY=ä½ çš„ OpenAI API Key
OPENAI_MODEL=gpt-4o  # é¸å¡«ï¼Œé è¨­ç‚º gpt-4oï¼Œå¯æ”¹ç‚ºå…¶ä»–æ¨¡å‹å¦‚ gpt-3.5-turbo
OPENAI_BASE_URL=     # é¸å¡«ï¼Œè‹¥ä½¿ç”¨ä»£ç†æœå‹™è«‹å¡«å…¥ï¼Œä¾‹å¦‚: https://your-proxy.com/v1
DIFY_API_KEY=ä½ çš„ DIFY API Key
DIFY_BASE_URL=http://llm.glsoft.ai/v1/chat-messages  # é¸å¡«ï¼Œé è¨­ç‚ºæ­¤ç¶²å€
```

3. å•Ÿå‹•æ©Ÿå™¨äººï¼š
```bash
python main.py
```

## æŒ‡ä»¤åˆ—è¡¨

| æŒ‡ä»¤ | åŠŸèƒ½æè¿° | ä½¿ç”¨ç¯„ä¾‹ |
|------|---------|---------|
| `/start` | å•Ÿå‹•æ©Ÿå™¨äºº | `/start` |
| `/s` | æŸ¥è©¢è‚¡åƒ¹èˆ‡ K ç·šåœ– | `/s 2330.TW` |
| `/n` | æŸ¥è©¢ç¾è‚¡æ–°è | `/n TSLA` |
| `/ny` | æŸ¥è©¢å°è‚¡æ–°è | `/ny 2330.TW` |
| `/p` | é æ¸¬æœªä¾† 5 å¤©è‚¡åƒ¹å€é–“ | `/p TSLA` |
| `/ai` | ç¶œåˆåŸºæœ¬é¢åˆ†æè©•ä¼°æŠ•è³‡åƒ¹å€¼ | `/ai TSLA` |
| `/ai2` | å¤šä½æŠ•è³‡å¤§å¸«é›†é«”åˆ†æ | `/ai2 NVDA` |
| `/llm` | ä½¿ç”¨ LLM å›ç­”è‚¡ç¥¨ç›¸é—œå•é¡Œ | `/llm AVGO çš„è‚¡åƒ¹å‰æ™¯å¦‚ä½•ï¼Ÿ` |
| `/h` | é¡¯ç¤ºå…¶ä»–è‚¡ç¥¨å·¥å…·é€£çµ | `/h` |

## è²¢ç»

æ­¡è¿è²¢ç»ï¼è«‹é€é Pull Request æäº¤æ‚¨çš„ä¿®æ”¹æˆ–æ”¹é€²å»ºè­°ã€‚

---

# Telegram Stock Information Bot (English)

## Overview

This is a Telegram Stock Information Bot built with Python and python-telegram-bot, capable of retrieving real-time stock data, generating K-line charts, forecasting stock prices, and providing AI-powered fundamental analysis.

It supports Taiwan Stock Exchange (TWSE) and U.S. Stocks.

## Features:

1. **Stock Price and K-line Charts**
   - `/s <stock_code>`: Retrieve the latest stock price, open, close, high, low prices, trading volume, and generate daily, weekly, and monthly K-line charts.

2. **U.S. Stock News**
   - `/n <stock_code>`: Retrieve the latest news for U.S. stocks.

3. **Taiwan Stock News**
   - `/ny <stock_code>`: Fetch Taiwan stock news from Yahoo.

4. **Stock Price Prediction**
   - `/p <stock_code>`: Predict the next 5 days' stock price range using the Prophet model.

5. **AI Fundamental Analysis**
   - `/ai <stock_code>`: Uses LangGraph and multiple tools for in-depth fundamental analysis, including:
     - Technical indicator analysis (RSI, MACD, VWAP, Stochastic Oscillator)
     - Financial health assessment (P/E, P/B, Debt-to-Equity, Profit Margins, etc.)
     - Latest news and market sentiment analysis
     - Comprehensive investment recommendations (Buy/Hold/Sell)

6. **Investment Gurus Analysis**
   - `/ai2 <stock_code>`: Connects to professional investment analysis API, providing collective analysis from multiple renowned investors:
     
     **Value Investing Masters (7):**
     - ğŸ‘´ Warren Buffett - Long-term value investing, seeking quality companies
     - ğŸ§“ Charlie Munger - Quality investing, seeking moats and high ROE
     - ğŸ“š Ben Graham - Father of value investing, emphasizes margin of safety
     - ğŸ‘¨â€ğŸ’¼ Bill Ackman - Activist value investing, focuses on quality businesses
     - ğŸ˜ Michael Burry - Deep value investing, seeks undervalued assets
     - ğŸ¤  Peter Lynch - Growth-at-reasonable-price, emphasizes PEG Ratio
     - ğŸ“– Phil Fisher - Growth potential analysis, values R&D and management quality
     
     **Growth & Innovation (1):**
     - ğŸ‘©â€ğŸ’¼ Cathie Wood - Disruptive innovation investing, focuses on AI, EVs, genomics
     
     **Technical & Sentiment Analysis (4):**
     - ğŸ‘µ Nancy Pelosi - Tracks congressional stock trading records
     - ğŸ¦ WallStreetBets - Reddit community sentiment, retail momentum analysis
     - ğŸ“‰ Technical Analyst - MA, RSI, MACD and other technical indicators
     - ğŸ” Sentiment Analyst - News sentiment analysis, market atmosphere assessment
     
     **Fundamentals & Valuation Analysis (2):**
     - ğŸ“ˆ Fundamentals Analyst - Deep financial statement analysis
     - ğŸ’° Valuation Analyst - Enterprise valuation models, DCF analysis
     
     - Final comprehensive decision (Buy/Sell/Hold/Short) with confidence score

7. **LLM Smart Responses**
   - `/llm <question>`: Connects to DIFY LLM API, uses advanced language models to answer stock-related questions:
     - Supports streaming responses for real-time AI analysis
     - Can answer any stock-related questions, e.g., `/llm What's the outlook for AVGO?`
     - Best used in combination with `/ai` or `/ai2` commands for in-depth Q&A

8. **Other Tools**
   - `/h`: Display links to other stock prediction tools.

## Technical Architecture

The bot employs an advanced technical stack:

- **Data Retrieval**: Uses `yfinance` to get real-time stock data
- **Data Visualization**: Uses `matplotlib` to generate professional financial charts
- **Web Scraping**: Uses `BeautifulSoup` to crawl the latest financial news
- **AI Model Integration**:
  - Uses `LangGraph` and `LangChain` to build tool chains for fundamental analysis
  - Integrates `Prophet` model for stock price prediction
- **Natural Language Processing**: Connects to external LLM APIs for intelligent responses

### Fundamental Analysis Tools

The `/ai`command uses three core tools for comprehensive analysis:

- **get_stock_prices**: Retrieves stock prices and technical indicators (RSI, MACD, VWAP, Stochastic Oscillator)
- **get_financial_metrics**: Obtains key financial indicators (P/E, P/B, Debt-to-Equity, Profit Margins, etc.)
- **get_financial_news**: Gets the latest news and analyzes their impact on market sentiment

## Deployment

### Run with Docker

To quickly start the bot, download the Docker image from Docker Hub:

```bash
docker pull tbdavid2019/telegram-bot-stock2:latest
```

Run the container with your API keys:

```bash
docker run -d --name telegram-bot-stock2 \
  -e TELEGRAM_BOT_TOKEN=<your_telegram_bot_token> \
  -e OPENAI_API_KEY=<your_openai_api_key> \
  -e OPENAI_MODEL=gpt-4o \
  -e OPENAI_BASE_URL=<optional_custom_api_endpoint> \
  -e DIFY_API_KEY=<your_dify_api_key> \
  -e DIFY_BASE_URL=<optional_defaults_to_http://llm.glsoft.ai/v1/chat-messages> \
  tbdavid2019/telegram-bot-stock2:latest
```

### Manual Deployment

#### Requirements

- Python 3.9+
- Dependencies (provided in requirements.txt)

#### Steps

1. Install dependencies:
```bash
pip install -r requirements.txt
```

2. Configure environment variables:
Create a .env file and add your API keys:
```
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
OPENAI_API_KEY=your-openai-api-key
OPENAI_MODEL=gpt-4o  # Optional, defaults to gpt-4o, can change to other models like gpt-3.5-turbo
OPENAI_BASE_URL=     # Optional, fill in if using a proxy service, e.g., https://your-proxy.com/v1
DIFY_API_KEY=your-dify-api-key
DIFY_BASE_URL=http://llm.glsoft.ai/v1/chat-messages  # Optional, defaults to this URL
```

3. Start the bot:
```bash
python main.py
```

## Command List

| Command | Description | Example Usage |
|---------|-------------|--------------|
| `/start` | Start the bot | `/start` |
| `/s` | Retrieve stock prices and K-line charts | `/s 2330.TW` |
| `/n` | Fetch U.S. stock news | `/n TSLA` |
| `/ny` | Fetch Taiwan stock news | `/ny 2330.TW` |
| `/p` | Predict stock prices for 5 days | `/p TSLA` |
| `/ai` | Comprehensive fundamental analysis | `/ai TSLA` |
| `/ai2` | Investment gurus collective analysis | `/ai2 NVDA` |
| `/llm` | Use LLM to answer stock-related questions | `/llm What's the outlook for AVGO?` |
| `/h` | Show links to other tools | `/h` |

## Contribution

Contributions are welcome! Please submit your modifications or suggestions via Pull Requests.